<%{ './master.ejs' }%>
    <%{ style %>
        <style>
            a:hover {
                text-decoration: underline;
            }
        </style>
        <%} %>
            <%{ content %>
                <div class="col-4 mx-auto">
                    <div class="border rounded-3 border-dark px-3">
                        <div class="row my-2 border-bottom border-dark align-items-end">
                            <div class="col">
                                <div class="d-flex justify-content-center">
                                    <img src="./icon.png" height="70">
                                </div>
                            </div>
                            <div class="col">
                                <h3 class="text-center">
                                    Welcome
                                </h3>
                            </div>
                            <div class="col">
                                <div class="d-flex justify-content-center">
                                    <img src="./icon.png" height="70">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3 mt-4">
                            <label class="form-label">Email address</label>
                            <input type="email" id="email" class="form-control border-dark"
                                aria-describedby="emailHelp">
                            <small id="email-errors" class="text-danger"></small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" id="password" class="form-control border-dark" </div>
                            <small id="password-errors" class="text-danger"></small>
                        </div>
                        <div class="mb-3">
                            <div class="row px-2 mt-4">
                                <button type="submit" id="btn-submit" class="btn btn-dark">Submit</button>
                            </div>
                        </div>
                        <div class="mb-3 text-center">
                            <a href="/register">Create an account</a>
                        </div>
                    </div>
                </div>
                <%} %>
                    <%{ script %>
                        <script>
                            $("input").keydown(function () {
                                let id = $(this).attr('id');
                                $(`#${id}-errors`).text("");
                            });

                            $('#btn-submit').on('click', () => {
                                let status;
                                fetch('/login',
                                    {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        },
                                        body: JSON.stringify({
                                            data: {
                                                email: $('#email').val(),
                                                password: $('#password').val()
                                            }
                                        })
                                    }
                                ).then(
                                    response => {
                                        status = response.status;
                                        return response.json();
                                    }
                                ).then(
                                    data => {
                                        console.log(status);
                                        switch (status) {
                                            case 400:
                                                handleVerifications(data);
                                                break;
                                            case 200:
                                                alert("Login ok.");
                                                break;
                                            default:
                                                alert(data.message);
                                                break;
                                        }
                                    }
                                ).catch((error) => {
                                    console.error('Error:', error);
                                });
                            });

                            function handleVerifications(data) {
                                console.log(data);
                                Object.keys(data.body).map(function (key, index) {
                                    let errors = data.body[key];
                                    errors.forEach(element => {
                                        $(`#${key}-errors`).text("");
                                    });
                                    errors.forEach(element => {
                                        $(`#${key}-errors`).append(element);
                                        $(`#${key}-errors`).append('<br>');
                                    });
                                });
                            }
                        </script>
                        <%} %>